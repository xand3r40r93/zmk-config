/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>

#define MOD_MORPH_SHIFT(NAME, KEY, MOD_KEY) \
  mm_##NAME: mm_##NAME { \
    compatible = "zmk,behavior-mod-morph"; \
    label = #NAME; \
    #binding-cells = <0>; \
    bindings = <&kp KEY>, <&kp MOD_KEY>; \
    mods = <(MOD_LSFT|MOD_RSFT)>; \
    keep-mods = <(MOD_LSFT|MOD_RSFT)>; \
  };

#define DEFAULT 0
#define NAVIGATION 1

// KEY POSITION REFERENCE
// ------------------------------------------------------------------------
// | 00 | 01 | 02 | 03 | 04 | 05 |    | 06 | 07 | 08 | 09 | 10 | 11 |
// | 12 | 13 | 14 | 15 | 16 | 17 |    | 18 | 19 | 20 | 21 | 22 | 23 |
// | 24 | 25 | 26 | 27 | 28 | 29 |    | 30 | 31 | 32 | 33 | 34 | 35 |
//                | 37 | 38 | 39 |    | 40 | 41 | 42 |

/ {

  behaviors {
    htl: hold_tap_left {
      compatible = "zmk,behavior-hold-tap";
      label = "HOLD_TAP_LEFT";
      #binding-cells = <2>;
      flavor = "tap-unless-interrupted";
      tapping-term-ms = <100>;
      quick-tap-ms = <200>;
      bindings = <&kp>, <&kp>;
      hold-trigger-key-positions = <6 7 8 9 10 11 18 19 20 21 22 23 30 31 32 33 34 35 40 41 42>;
    };
    htr: hold_tap_right {
      compatible = "zmk,behavior-hold-tap";
      label = "HOLD_TAP_RIGHT";
      #binding-cells = <2>;
      flavor = "tap-unless-interrupted";
      tapping-term-ms = <100>;
      quick-tap-ms = <200>;
      bindings = <&kp>, <&kp>;
      hold-trigger-key-positions = <0 1 2 3 4 5 12 13 14 15 16 17 24 25 26 27 28 29 37 38 39>;
    };
    hm: homerow_mods {
        compatible = "zmk,behavior-hold-tap";
        label = "HOMEROW_MODS";
        #binding-cells = <2>;
        tapping-term-ms = <200>;
        quick-tap-ms = <0>;
        flavor = "balanced";
        bindings = <&kp>, <&kp>;
    };
    MOD_MORPH_SHIFT(single_quote, SINGLE_QUOTE, TILDE) // ' | `
  };

  keymap {
    compatible = "zmk,keymap";

      default_layer {
        bindings = <

          &kp ESC                       // Tab       -> Esc |
          &kp Q                         // q         -> q   | Q
          &kp W                         // w         -> w   | W
          &kp E                         // e         -> e   | E
          &kp R                         // r         -> r   | R
          &kp T                         // t         -> t   | T

          &kp Y                         // y         -> y   | Y
          &kp U                         // u         -> u   | U
          &kp I                         // i         -> i   | I
          &kp O                         // o         -> o   | O
          &kp P                         // p         -> p   | P
          &kp EQUAL                     // \         -> =   | _

          &kp TAB                       // Caps Lock
          &htl LEFT_CONTROL A                         // a
          &htl LEFT_ALT S                         // s
          &htl LEFT_SHIFT D                         // d
          &htl LEFT_COMMAND F                         // f
          &kp G                         // g

          &kp H                         // h
          &htr RIGHT_COMMAND J                         // j
          &htr RIGHT_SHIFT K                         // k
          &htr RIGHT_ALT L                         // l
          &mm_single_quote              // ;
          &kp RETURN                    // '
          
          &kp LSHFT        // Left Shift
          &kp Z            // z
          &kp X            // x
          &kp C            // c
          &kp V            // v
          &kp B            // b

          &kp N           // n
          &kp M           // m
          &kp COMMA       // ,
          &kp DOT         // .
          &hm RIGHT_CONTROL FSLH        // /
          &kp RETURN      // Right Shift    -> Return 

          &kp LGUI                      // Left Option
          &mo 2                         // Left Command
          &lt NAVIGATION SPACE          // Space

          &lt NAVIGATION SPACE          // Space
          &mo 3                         // Right Command
          &kp BACKSPACE                 // Right Option

        >;
      };

      navigation_layer {
        bindings = <

          &trans
          &kp F1
          &kp F2
          &kp F3
          &kp F4
          &trans

          &trans
          &kp HOME
          &kp UP_ARROW
          &kp END
          &kp PAGE_UP
          &kp BACKSPACE

          &trans
          &htl LEFT_CONTROL F5
          &htl LEFT_ALT F6
          &htl LEFT_SHIFT F7
          &htl LEFT_COMMAND F8
          &trans

          &trans
          &htr LEFT_ARROW
          &htr DOWN_ARROW
          &htr RIGHT_ARROW
          &htr PAGE_DOWN
          &trans

          &trans
          &kp F9
          &kp F10
          &kp F11
          &kp F12
          &trans

          &trans
          &trans
          &trans
          &trans
          &trans
          &trans

          &trans
          &trans
          &trans

          &trans
          &trans
          &trans

        >;
      };

      lower_layer {
        bindings = <

        &kp TAB
        &kp N1
        &kp N2
        &kp N3
        &kp N4
        &kp N5
        
        &kp N6
        &kp N7
        &kp N8
        &kp N9
        &kp N0
        &kp BSPC

        &bt BT_CLR
        &bt BT_SEL 0
        &bt BT_SEL 1
        &bt BT_SEL 2
        &bt BT_SEL 3
        &bt BT_SEL 4

        &kp LEFT
        &kp DOWN
        &kp UP
        &kp RIGHT
        &trans
        &trans

        &kp LSHFT
        &trans
        &trans
        &trans
        &trans
        &trans

        &trans
        &trans
        &trans
        &trans
        &trans
        &trans

        &kp LGUI
        &trans
        &kp SPACE
        
        &kp RET
        &trans
        &kp RALT

      >;
    };

    raise_layer {
      bindings = <

        &kp TAB
        &kp EXCL
        &kp AT
        &kp HASH
        &kp DLLR
        &kp PRCNT

        &kp CARET
        &kp AMPS
        &kp KP_MULTIPLY
        &kp LPAR
        &kp RPAR
        &kp BSPC

        &kp LCTRL
        &trans
        &trans
        &trans
        &trans
        &trans
        
        &kp MINUS
        &kp EQUAL
        &kp LBKT
        &kp RBKT
        &kp BSLH
        &kp GRAVE

        &kp LSHFT
        &trans
        &trans
        &trans
        &trans
        &trans

        &kp UNDER
        &kp PLUS
        &kp LBRC
        &kp RBRC
        &kp PIPE
        &kp TILDE

        &kp LGUI
        &trans
        &kp SPACE
        
        &kp RET
        &trans
        &kp RALT

      >;
    };

  };

};
